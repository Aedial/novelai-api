
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>novelai_api._low_level &#8212; NovelAI API 0.34.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster.custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-shadow.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-punk.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-noir.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-light.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tooltipster-sideTip-borderless.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/micromodal.css" />
    
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/hoverxref.js"></script>
    <script src="../../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../../_static/js/micromodal.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NovelAI API 0.34.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">novelai_api._low_level</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for novelai_api._low_level</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">operator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">AsyncIterator</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">quote</span><span class="p">,</span> <span class="n">urlencode</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">aiohttp</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aiohttp.client_reqrep</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientResponse</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">novelai_api.DirectorToolsPreset</span><span class="w"> </span><span class="kn">import</span> <span class="n">DirectorToolsPreset</span><span class="p">,</span> <span class="n">RequestType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">novelai_api.ImagePreset</span><span class="w"> </span><span class="kn">import</span> <span class="n">ControlNetModel</span><span class="p">,</span> <span class="n">ImageGenerationType</span><span class="p">,</span> <span class="n">ImageModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">novelai_api.NovelAIError</span><span class="w"> </span><span class="kn">import</span> <span class="n">NovelAIError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">novelai_api.Preset</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">novelai_api.python_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoneType</span><span class="p">,</span> <span class="n">assert_len</span><span class="p">,</span> <span class="n">assert_type</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">novelai_api.SchemaValidator</span><span class="w"> </span><span class="kn">import</span> <span class="n">SchemaValidator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">novelai_api.Tokenizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tokenizer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">novelai_api.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">tokens_to_b64</span>

<span class="n">PRINT_WITH_PARAMETERS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NAI_PRINT&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">GENERAL_API_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;https://api.novelai.net&quot;</span>
<span class="n">IMAGE_API_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;https://image.novelai.net&quot;</span>
<span class="n">TEXT_API_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;https://text.novelai.net&quot;</span>


<span class="c1"># === INTERNALS === #</span>
<span class="n">SSE_FIELDS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;retry&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="print_with_parameters"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.print_with_parameters">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">print_with_parameters</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the provided parameters in a nice way</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;input&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">a</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">][:</span><span class="mi">40</span><span class="p">]</span><span class="si">}</span><span class="s2">...</span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">40</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">])</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;parameters&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">a</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;reference_image&quot;</span><span class="p">,</span> <span class="s2">&quot;reference_image_multiple&quot;</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;controlnet_condition&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]:</span>
                <span class="n">a</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">...</span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="mi">30</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">a</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">...</span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="mi">30</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">])</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></div>


<span class="c1"># === API === #</span>
<div class="viewcode-block" id="LowLevel"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">LowLevel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Low level API for NovelAI. This class is not meant to be used directly,</span>
<span class="sd">    but rather through :attr:`NovelAIAPI.low_level &lt;novelai_api.NovelAI_API.NovelAIAPI.low_level&gt;`.</span>

<span class="sd">    The most relevant methods are:</span>

<span class="sd">    * :meth:`login &lt;novelai_api._low_level.LowLevel.login&gt;`</span>
<span class="sd">    * :meth:`generate &lt;novelai_api._low_level.LowLevel.generate&gt;`</span>
<span class="sd">    * :meth:`generate_image &lt;novelai_api._low_level.LowLevel.generate_image&gt;`</span>
<span class="sd">    * :meth:`get_keystore &lt;novelai_api._low_level.LowLevel.get_keystore&gt;`</span>
<span class="sd">    * :meth:`download_objects &lt;novelai_api._low_level.LowLevel.download_objects&gt;`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_parent</span><span class="p">:</span> <span class="s2">&quot;NovelAIAPI&quot;</span>  <span class="c1"># noqa: F821</span>
    <span class="n">_is_async</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="c1">#: Enable or disable schema validation for responses. Default is ``True``.</span>
    <span class="n">is_schema_validation_enabled</span><span class="p">:</span> <span class="nb">bool</span>

<div class="viewcode-block" id="LowLevel.__init__"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.__init__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="s2">&quot;NovelAIAPI&quot;</span><span class="p">):</span>  <span class="c1"># noqa: F821</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">:</span> <span class="n">ClientResponse</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">rsp</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">human_repr</span><span class="p">()</span>

        <span class="c1"># error is an unexpected fail and usually come with a success status</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NovelAIError</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">rsp</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>

        <span class="c1"># success</span>
        <span class="k">if</span> <span class="n">rsp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">content</span>

        <span class="c1"># not success, but valid response</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;message&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>  <span class="c1"># NovelAI REST API error</span>
            <span class="k">raise</span> <span class="n">NovelAIError</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">rsp</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>

        <span class="c1"># HTTPException error</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">NovelAIError</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">rsp</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>

        <span class="k">raise</span> <span class="n">NovelAIError</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">rsp</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot;Unknown error&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_treat_response_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsp</span><span class="p">:</span> <span class="n">ClientResponse</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rsp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_parse_sse_stream</span><span class="p">(</span><span class="n">rsp</span><span class="p">:</span> <span class="n">ClientResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a stream of Server Sent Event from an aiohttp ClientResponse</span>
<span class="sd">        Specs: https://html.spec.whatwg.org/multipage/server-sent-events.html</span>

<span class="sd">        This function consider all end of line to be &#39;\\n&#39;. &#39;\\r&#39; is not handled, albeit legal in the spec</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sse_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">partial_data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">rsp</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_any</span><span class="p">():</span>  <span class="c1"># type: bytes</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">partial_data</span><span class="si">}{</span><span class="n">chunk</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="c1"># empty line = dispatch event if modified</span>
                    <span class="k">if</span> <span class="n">modified</span><span class="p">:</span>
                        <span class="n">sse_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sse_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                        <span class="k">yield</span> <span class="n">sse_data</span>

                        <span class="n">sse_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[]}</span>
                        <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">continue</span>

                <span class="c1"># no newline = partial line</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="n">partial_data</span> <span class="o">=</span> <span class="n">line</span>
                    <span class="k">continue</span>

                <span class="c1"># strip the newline</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">colon</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>

                <span class="c1"># starting with colon = ignore the line</span>
                <span class="k">if</span> <span class="n">colon</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># no colon = line is field, value is empty</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">line</span> <span class="k">if</span> <span class="n">colon</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">line</span><span class="p">[:</span><span class="n">colon</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">colon</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">line</span><span class="p">[</span><span class="n">colon</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>

                <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SSE_FIELDS</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># multiple data fields = we merge them with a newline</span>
                <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
                    <span class="n">sse_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># ignore special handling of &quot;retry&quot; and NULL in &quot;id&quot;</span>
                    <span class="n">sse_data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@classmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_parse_response</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rsp</span><span class="p">:</span> <span class="n">ClientResponse</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the content of a ClientResponse depending on the content-type</span>

<span class="sd">        :param rsp: ClientResponse returned by a request</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content_type</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">content_type</span>

        <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;application/json&quot;</span><span class="p">:</span>
            <span class="k">yield</span> <span class="k">await</span> <span class="n">rsp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;application/binary&quot;</span><span class="p">:</span>
            <span class="k">yield</span> <span class="k">await</span> <span class="n">rsp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html&quot;</span><span class="p">):</span>
            <span class="k">yield</span> <span class="k">await</span> <span class="n">rsp</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;audio/mpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;audio/webm&quot;</span><span class="p">):</span>
            <span class="k">yield</span> <span class="k">await</span> <span class="n">rsp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;application/x-zip-compressed&quot;</span><span class="p">,</span> <span class="s2">&quot;binary/octet-stream&quot;</span><span class="p">):</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="k">await</span> <span class="n">rsp</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">z</span><span class="o">.</span><span class="n">namelist</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">z</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;text/event-stream&quot;</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_parse_sse_stream</span><span class="p">(</span><span class="n">rsp</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">rsp</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">rsp</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">human_repr</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">NovelAIError</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unsupported type: </span><span class="si">{</span><span class="n">rsp</span><span class="o">.</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="LowLevel.request"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.request">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_base_address</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send request with support for data streaming</span>

<span class="sd">        :param method: Method of the request (get, post, delete)</span>
<span class="sd">        :param endpoint: Endpoint of the request</span>
<span class="sd">        :param data: Data to pass to the method if needed</span>
<span class="sd">        :param custom_base_address: Custom address to use for the request</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">PRINT_WITH_PARAMETERS</span><span class="p">:</span>
            <span class="n">print_with_parameters</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">custom_base_address</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custom_base_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">BASE_ADDRESS</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">custom_base_address</span><span class="si">}{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">is_sync</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">ClientSession</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_sync</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">session</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
            <span class="s2">&quot;cookies&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">cookies</span><span class="p">,</span>
            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
            <span class="s2">&quot;json&quot;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;proxy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">proxy</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">proxy_auth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;proxy_auth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">proxy_auth</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">rsp</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response</span><span class="p">(</span><span class="n">rsp</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_sync</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="LowLevel.is_reachable"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.is_reachable">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">is_reachable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the NovelAI API is reachable</span>

<span class="sd">        :return: True if reachable, False if not</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_bool</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.register"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.register">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">recapcha</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">access_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">giftkey</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a new account</span>

<span class="sd">        :param recapcha: Recapcha of the NovelAI website</span>
<span class="sd">        :param access_key: Access key of the account</span>
<span class="sd">        :param email: Hashed email (used for recovery)</span>
<span class="sd">        :param giftkey: Giftkey</span>

<span class="sd">        :return: True if success</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">recapcha</span><span class="o">=</span><span class="n">recapcha</span><span class="p">,</span> <span class="n">access_key</span><span class="o">=</span><span class="n">access_key</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">),</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">giftkey</span><span class="o">=</span><span class="n">giftkey</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">access_key</span><span class="o">=</span><span class="n">access_key</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;recapcha&quot;</span><span class="p">:</span> <span class="n">recapcha</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">access_key</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">email</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span>
        <span class="k">if</span> <span class="n">giftkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;giftkey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">giftkey</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/register&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_SuccessfulLoginResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.login"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.login">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">access_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log in to the account</span>

<span class="sd">        :param access_key: Access key of the account</span>

<span class="sd">        :return: Response of the request</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">access_key</span><span class="o">=</span><span class="n">access_key</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">access_key</span><span class="o">=</span><span class="n">access_key</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/login&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">access_key</span><span class="p">}):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_SuccessfulLoginResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.change_access_key"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.change_access_key">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">change_access_key</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">current_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the access key of the given account</span>

<span class="sd">        :param current_key: Current key of the account</span>
<span class="sd">        :param new_key: New key of the account</span>
<span class="sd">        :param new_email: New email, if it changed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">current_key</span><span class="o">=</span><span class="n">current_key</span><span class="p">,</span> <span class="n">new_key</span><span class="o">=</span><span class="n">new_key</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">),</span> <span class="n">new_email</span><span class="o">=</span><span class="n">new_email</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">current_key</span><span class="o">=</span><span class="n">current_key</span><span class="p">,</span> <span class="n">new_key</span><span class="o">=</span><span class="n">new_key</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;currentAccessKey&quot;</span><span class="p">:</span> <span class="n">current_key</span><span class="p">,</span> <span class="s2">&quot;newAccessKey&quot;</span><span class="p">:</span> <span class="n">new_key</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">new_email</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;newEmail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_email</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/change-access-key&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_SuccessfulLoginResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.send_email_verification"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.send_email_verification">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_email_verification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the email for account verification</span>

<span class="sd">        :param email: Address to send the email to</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/resend-email-verification&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">}):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_bool</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.verify_email"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.verify_email">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">verify_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verification_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the token sent for email verification</span>

<span class="sd">        :param verification_token: Token sent to the email address</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">verification_token</span><span class="o">=</span><span class="n">verification_token</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">verification_token</span><span class="o">=</span><span class="n">verification_token</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/verify-email&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;verificationToken&quot;</span><span class="p">:</span> <span class="n">verification_token</span><span class="p">}):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_bool</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.get_information"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.get_information">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get extensive information about the account</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/information&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_AccountInformationResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.request_account_recovery"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.request_account_recovery">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">request_account_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a recovery token to the provided email address, if the account has been lost</span>
<span class="sd">        **WARNING**: the content will not be readable with a different encryption key</span>

<span class="sd">        :param email: Address to send the email to</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/recovery/request&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">}):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_bool</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">202</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.recover_account"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.recover_account">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recover_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recovery_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delete_content</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recover the lost account</span>

<span class="sd">        :param recovery_token: Token sent to the given email address</span>
<span class="sd">        :param new_key: New access key for the account</span>
<span class="sd">        :param delete_content: Delete all content that was on the account</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">recovery_token</span><span class="o">=</span><span class="n">recovery_token</span><span class="p">,</span> <span class="n">new_key</span><span class="o">=</span><span class="n">new_key</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">delete_content</span><span class="o">=</span><span class="n">delete_content</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">,</span> <span class="n">recovery_token</span><span class="o">=</span><span class="n">recovery_token</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">new_key</span><span class="o">=</span><span class="n">new_key</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;recoveryToken&quot;</span><span class="p">:</span> <span class="n">recovery_token</span><span class="p">,</span>
            <span class="s2">&quot;newAccessKey&quot;</span><span class="p">:</span> <span class="n">new_key</span><span class="p">,</span>
            <span class="s2">&quot;deleteContent&quot;</span><span class="p">:</span> <span class="n">delete_content</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/recovery/recover&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_SuccessfulLoginResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.delete_account"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.delete_account">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_account</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the account</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/delete&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_bool</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.get_data"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.get_data">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get various data about the account</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/data&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="c1"># FIXME: doesn&#39;t seem right</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_AccountInformationResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.get_priority"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.get_priority">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the priority information of the account</span>

<span class="sd">        The priority system is a legacy system and isn&#39;t really important</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/priority&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_PriorityResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.SubscriptionTier"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.SubscriptionTier">[docs]</a>    <span class="k">class</span><span class="w"> </span><span class="nc">SubscriptionTier</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Index of the subscription tiers</span>

<span class="sd">        PAPER tier is the free trial</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">PAPER</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">TABLET</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">SCROLL</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">OPUS</span> <span class="o">=</span> <span class="mi">3</span></div>

<div class="viewcode-block" id="LowLevel.get_subscription"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.get_subscription">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get various information about the account&#39;s subscription</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/subscription&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_SubscriptionResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.get_keystore"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.get_keystore">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_keystore</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the keystore</span>

<span class="sd">        The keystore is the storage for the encryption keys of any content on the account.</span>
<span class="sd">        Losing it is equal to losing all your encrypted content</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/keystore&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_GetKeystoreResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.set_keystore"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.set_keystore">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_keystore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keystore</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the keystore</span>

<span class="sd">        The keystore is the storage for the encryption keys of any content on the account.</span>
<span class="sd">        Losing it (or overwriting it with wrong data) is equal to losing all your encrypted content</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">keystore</span><span class="o">=</span><span class="n">keystore</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/keystore&quot;</span><span class="p">,</span> <span class="n">keystore</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.download_objects"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.download_objects">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download all the objects of a given type from the account</span>

<span class="sd">        :param object_type: Type of the objects to download</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">object_type</span><span class="o">=</span><span class="n">object_type</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/user/objects/</span><span class="si">{</span><span class="n">object_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_ObjectsResponse&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.upload_objects"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.upload_objects">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">upload_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload multiple objects of the given type</span>

<span class="sd">        :param object_type: Type of the objects to upload</span>
<span class="sd">        :param meta: Meta of the objects to upload (meta links to encryption key in keystore)</span>
<span class="sd">        :param data: Serialized data of the content to upload</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">object_type</span><span class="o">=</span><span class="n">object_type</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/user/objects/</span><span class="si">{</span><span class="n">object_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.download_object"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.download_object">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download the selected object of a given type from the account</span>

<span class="sd">        :param object_type: Type of the object to download</span>
<span class="sd">        :param object_id: Id of the selected object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">object_type</span><span class="o">=</span><span class="n">object_type</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/user/objects/</span><span class="si">{</span><span class="n">object_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_UserData&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.upload_object"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.upload_object">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">upload_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload an object of then given type</span>

<span class="sd">        :param object_type: Type of the object to upload</span>
<span class="sd">        :param meta: Meta of the object to upload (meta links to encryption key in keystore)</span>
<span class="sd">        :param data: Serialized data of the content to upload</span>
<span class="sd">        :param object_id: Id of the selected object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">object_type</span><span class="o">=</span><span class="n">object_type</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">assert_len</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/user/objects/</span><span class="si">{</span><span class="n">object_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.delete_object"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.delete_object">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download the selected object of a given type from the account</span>

<span class="sd">        :param object_type: Type of the object to delete</span>
<span class="sd">        :param object_id: Id of the selected object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">object_type</span><span class="o">=</span><span class="n">object_type</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/user/objects/</span><span class="si">{</span><span class="n">object_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">object_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.get_settings"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.get_settings">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the account settings. The format is arbitrary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/clientsettings&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.set_settings"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.set_settings">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the account settings. The format is arbitrary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/clientsettings&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_bool</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

    <span class="c1"># TODO: add submission endpoints</span>

<div class="viewcode-block" id="LowLevel.bind_subscription"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.bind_subscription">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bind_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payment_processor</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">subscription_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bind payment information to the account to renew subscription monthly</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">payment_processor</span><span class="o">=</span><span class="n">payment_processor</span><span class="p">,</span> <span class="n">subscription_id</span><span class="o">=</span><span class="n">subscription_id</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;paymentProcessor&quot;</span><span class="p">:</span> <span class="n">payment_processor</span><span class="p">,</span> <span class="s2">&quot;subscriptionId&quot;</span><span class="p">:</span> <span class="n">subscription_id</span><span class="p">}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/subscription/bind&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_bool</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.change_subscription"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.change_subscription">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">change_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_plan</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the subscription tier. Payment information should still be bound to the account</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">new_plan</span><span class="o">=</span><span class="n">new_plan</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/user/subscription/change&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;newSubscriptionPlan&quot;</span><span class="p">:</span> <span class="n">new_plan</span><span class="p">}):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_bool</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.generate"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.generate">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate text with streaming support. As the model accepts a complete prompt,</span>
<span class="sd">        the context building must be done before calling this function.</span>
<span class="sd">        Any content going beyond the tokens limit will be truncated, starting from the top.</span>

<span class="sd">        :param prompt: Input to be sent the AI</span>
<span class="sd">        :param model: Model of the AI</span>
<span class="sd">        :param params: Generation parameters</span>
<span class="sd">        :param stream: Use data streaming for the response</span>

<span class="sd">        :return: Generated output</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>

        <span class="n">token_size</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="n">Model</span><span class="o">.</span><span class="n">Erato</span> <span class="k">else</span> <span class="mi">2</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">tokens_to_b64</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">token_size</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">}</span>

        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;/ai/generate-stream&quot;</span> <span class="k">if</span> <span class="n">stream</span> <span class="k">else</span> <span class="s2">&quot;/ai/generate&quot;</span>

        <span class="c1"># TODO: change that when they finally move the older models to the new API... sigh</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">Kayra</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">Erato</span><span class="p">):</span>
            <span class="n">base_address</span> <span class="o">=</span> <span class="n">TEXT_API_ADDRESS</span>
            <span class="n">status</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_address</span> <span class="o">=</span> <span class="n">GENERAL_API_ADDRESS</span>
            <span class="n">status</span> <span class="o">=</span> <span class="mi">201</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">base_address</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.generate_image"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.generate_image">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ImageModel</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">ImageGenerationType</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate one or multiple image(s)</span>

<span class="sd">        :param prompt: Prompt for the image</span>
<span class="sd">        :param model: Model to generate the image</span>
<span class="sd">        :param action: Type of image generation to use</span>
<span class="sd">        :param parameters: Parameters for the images</span>

<span class="sd">        :return: (name, data) pairs for the raw PNG image(s)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="n">ImageModel</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/generate-image&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">IMAGE_API_ADDRESS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.generate_prompt"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.generate_prompt">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a prompt</span>

<span class="sd">        :param model: Model to use for the prompt</span>
<span class="sd">        :param prompt: Prompt to base the generation on</span>
<span class="sd">        :param temp: Temperature for the generation</span>
<span class="sd">        :param length: Length of the returned prompt</span>

<span class="sd">        :return: Generated prompt</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
            <span class="s2">&quot;temp&quot;</span><span class="p">:</span> <span class="n">temp</span><span class="p">,</span>
            <span class="s2">&quot;tokens_to_generate&quot;</span><span class="p">:</span> <span class="n">length</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/generate-prompt&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.generate_controlnet_mask"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.generate_controlnet_mask">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_controlnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ControlNetModel</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the ControlNet&#39;s mask for the given image. Used for ImageSampler.controlnet_condition</span>

<span class="sd">        :param model: ControlNet model to use</span>
<span class="sd">        :param image: b64 encoded PNG image to get the mask of</span>

<span class="sd">        :return: A pair (name, data) for the raw PNG image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="n">ControlNetModel</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">}}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/annotate-image&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.upscale_image"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.upscale_image">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">upscale_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upscale the given image. Afaik, the only allowed values for scale are 2 and 4.</span>

<span class="sd">        :param image: b64 encoded PNG image to upscale</span>
<span class="sd">        :param width: Width of the starting image</span>
<span class="sd">        :param height: Height of the starting image</span>
<span class="sd">        :param scale: Upscaling factor (final width = starting width * scale, final height = starting height * scale)</span>

<span class="sd">        :return: A pair (name, data) for the raw PNG image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">scale</span><span class="p">}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/upscale&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.encode_vibe"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.encode_vibe">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">encode_vibe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ImageModel</span><span class="p">,</span> <span class="n">information_extracted</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Encode an image to a vibe, for model v4+.</span>
<span class="sd">        Note: the result is non-deterministic, this is the endpoint&#39;s fault:</span>

<span class="sd">        :param image: b64 encoded PNG image to encode</span>
<span class="sd">        :param model: Model to use for the encoding</span>
<span class="sd">        :param information_extracted: Amount of information extracted from the image (default: 1)</span>

<span class="sd">        :return: Encoded vibe (binary data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="n">ImageModel</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">information_extracted</span><span class="o">=</span><span class="n">information_extracted</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;informationExtracted&quot;</span><span class="p">:</span> <span class="n">information_extracted</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/encode-vibe&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">IMAGE_API_ADDRESS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.augment_image"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.augment_image">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">augment_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_type</span><span class="p">:</span> <span class="n">RequestType</span><span class="p">,</span> <span class="n">preset</span><span class="p">:</span> <span class="n">DirectorToolsPreset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Augment the given image with the given preset</span>

<span class="sd">        :param request_type: Type of request to use</span>
<span class="sd">        :param preset: Preset to use for the augmentation</span>

<span class="sd">        :return: A pair (name, data) for the raw PNG image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="n">RequestType</span><span class="p">,</span> <span class="n">request_type</span><span class="o">=</span><span class="n">request_type</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="n">DirectorToolsPreset</span><span class="p">,</span> <span class="n">preset</span><span class="o">=</span><span class="n">preset</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">preset</span><span class="o">.</span><span class="n">to_settings</span><span class="p">(</span><span class="n">request_type</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/augment-image&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">IMAGE_API_ADDRESS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.classify"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.classify">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Not implemented</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Function is not implemented yet&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LowLevel.suggest_tags"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.suggest_tags">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">suggest_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ImageModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Suggest tags with a certain confidence, considering how much the tag is used in the dataset</span>

<span class="sd">        :param tag: Tag to suggest others of</span>
<span class="sd">        :param model: Image model to get the tags from</span>

<span class="sd">        :return: List of similar tags with a confidence level</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="n">ImageModel</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">tag</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">quote_via</span><span class="o">=</span><span class="n">quote</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/ai/generate-image/suggest-tags?</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">IMAGE_API_ADDRESS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.generate_voice"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.generate_voice">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_voice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">voice</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opus</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the Text To Speech of the given text</span>

<span class="sd">        :param text: Text to synthesize into voice (text will be cut to 1000 characters backend-side)</span>
<span class="sd">        :param seed: Voice to use (TTS v2 only)</span>
<span class="sd">        :param voice: Index of the voice to use (TTS v1 only)</span>
<span class="sd">        :param opus: True for WebM format, False for mp3 format</span>
<span class="sd">        :param version: Version of the TTS (&quot;v1&quot; or &quot;v2&quot;)</span>

<span class="sd">        :return: TTS audio data of the text</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">voice</span><span class="o">=</span><span class="n">voice</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">opus</span><span class="o">=</span><span class="n">opus</span><span class="p">)</span>

        <span class="c1"># urlencode keeps capitalization on bool =_=</span>
        <span class="n">opus</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">opus</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
                <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="p">,</span>
                <span class="s2">&quot;voice&quot;</span><span class="p">:</span> <span class="n">voice</span><span class="p">,</span>
                <span class="s2">&quot;opus&quot;</span><span class="p">:</span> <span class="n">opus</span><span class="p">,</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">quote_via</span><span class="o">=</span><span class="n">quote</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/ai/generate-voice?</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.train_module"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.train_module">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">train_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Train a module for text gen</span>

<span class="sd">        :param data: Dataset of the module, in one single string</span>
<span class="sd">        :param rate: Learning rate of the training</span>
<span class="sd">        :param steps: Number of steps to train the module for</span>
<span class="sd">        :param name: Name of the module</span>
<span class="sd">        :param desc: Description of the module</span>

<span class="sd">        :return: Status of the module being trained</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">)</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
            <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="n">rate</span><span class="p">,</span>
            <span class="s2">&quot;steps&quot;</span><span class="p">:</span> <span class="n">steps</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">desc</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/module/train&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>

            <span class="c1"># TODO: verify response ?</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.get_trained_modules"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.get_trained_modules">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_trained_modules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the modules currently in training or that finished training</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/module/all&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_AiModuleDtos&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.get_trained_module"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.get_trained_module">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_trained_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a module currently in training or that finished training</span>

<span class="sd">        :param module_id: Id of the selected module</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">module_id</span><span class="o">=</span><span class="n">module_id</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/ai/module/</span><span class="si">{</span><span class="n">module_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_schema_validation_enabled</span><span class="p">:</span>
                <span class="n">SchemaValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="s2">&quot;schema_AiModuleDto&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.delete_module"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.delete_module">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a module currently in training or that finished training</span>

<span class="sd">        :param module_id: Id of the selected module</span>

<span class="sd">        :return: Module that got deleted</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">assert_type</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">module_id</span><span class="o">=</span><span class="n">module_id</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/ai/module/</span><span class="si">{</span><span class="n">module_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="c1"># TODO: verify response ?</span>

            <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="LowLevel.buy_steps"><a class="viewcode-back" href="../../novelai_api/novelai_api.low_level.html#novelai_api._low_level.LowLevel.buy_steps">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">buy_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">assert_type</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">}</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">rsp</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;/ai/module/buy-training-steps&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treat_response_object</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

            <span class="c1"># TODO: verify response ?</span>

            <span class="k">return</span> <span class="n">content</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NovelAI API 0.34.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">novelai_api._low_level</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2025, Aedial.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    </div>
  </body>
</html>